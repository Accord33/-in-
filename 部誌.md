# 題名(仮)

## 1.はじめに
&nbsp;&nbsp;はじめまして.「#プログラミング初心者と繋がりたい」つけてる人一年後プログラミングやってないAccord33こと坂部です.先輩との縁もあり,今回部誌に参加させていただくことになりました.  
&nbsp;&nbsp;ところでみなさんプログラミングはしていますか？私はよくプログラミングをします.ノートパソコンでプログラミングをすると,キーボードがすり減ってきたり,反応すらしなくなることがしばしばあります.それを回避するため普段からHHKBというキーボードをパソコン上において使うという尊師スタイルでプログラムを書いているのですが,下の画像を見て分かる通りトラックパッドが使えないのです.USBハブとマウスを持ち歩くのもいいですが邪魔ですね.じゃあ普段パソコン横に置いてるスマホとトラックパッドにしてしまえばいいじゃない！**ということでLet's 開発!!!**

## 2.実はそんなアプリあるんじゃねーの？&開発設計
&nbsp;&nbsp;そんなこんなありまして開発が始まりますが,優秀な先人たちがもうすでに開発をしているのではないか...調べてみたところスマホアプリとしてBlueToothで繋げるものはありましたが,PCで完結するようなものは無いようです.ということでPCで完結するようにHTMLとJavaScriptを用いてスマホをタップしたのを感知してPCのマウスカーソルを動かせるという流れで開発をします.つまり構造としては以下のような流れになります.(以下図の挿入)  
スマホ画面のタップ→PC内で建てたサーバーに座標データを送信→送信されたデータを元にカーソルの移動量を計算→カーソルの移動  
&nbsp;&nbsp;設計は完成しましたね.そしたら技術選定なんですが,私自身生粋のPythonistなのでサーバーサイドはPythonのFlaskというフレームワークを使い,データ送信はJavascriptで行います.異論は認めません.

## 3.開発の流れ
1. ブラウザでできるお絵描きアプリの作成
2. 座標データをサーバーに送信
3. データを受け取りカーソルに適用(この時点ではブラウザのタップ座標とウィンドウのカーソルの位置は相対的に同じです)
4. 座標データではなく移動量を送信
5. 受け取った量をカーソルの移動量に変更
6. なんやかんやして二本指にも対応

## 4.いざ開発と行かん！！
### 4.1 JavaScriptでお絵描きアプリの作成
&nbsp;&nbsp;JavaScriptはほぼ触ったことがないのでとりあえずネットで「HTML お絵描きアプリ」で一番上に出てきたものをパクります.  
なぜお絵描きアプリなのかというと,お絵描きアプリはなぞったところに線を引くことができます.つまり画面上の指の位置がわかるのです.第一段階としてタップやなぞられた指の位置がわかることが必須なのですが,作ったことはないのでコードをパクり必要なところ以外は消してしまいます.構成としてはHTMLに全画面でCanvasを広げJavaScriptでタップされた座標を取得しています.

### 4.2 座標データをサーバーに送信する
&nbsp;&nbsp;座標データが取得できたらそれをサーバーに送ります.Pythonで建てた適当なサーバーにGET通信を使ってデータを送信してみます.以下がそのPythonコードです.JavaScriptでは非同期通信を用いて送信しています.

### 4.3　データを受け取りカーソルに適用できる.
&nbsp;&nbsp;現状JavaScriptから送信されているデータはスマホ画面上の座標です.しかし原点はPCもスマホも同じなので相対的に同じ座標であり,倍率を合わせてあげればスマホ画面上で触ったところにカーソルを移動させることができます.今回カーソルの移動にはPythonのライブラリのPyAutoGUIを使います.このライブラリはデスクトップ画面の操作をしてくれるライブラリでマウスカーソルの移動やクリック,キー入力までもプログラムを通して行うことが出来ます.  
&nbsp;&nbsp;送信されてきた座標から倍率を合わせてあげることで,マウスカーソルを移動させることができました.

### 4.4 座標データではなく移動量を送信する && 4.5 受け取った移動量をカーソルの移動量にしました
&nbsp;&nbsp;一つ前の話で,スマホ画面上のタップ座標とウィンドウ上のマウス座標は相対的に同じという話をしましたが,そうすると,一番左上に行くにはスマホ画面の左上を触る必要があります.またこれはHTMLのCanvasをウィンドウの比率と同じにする必要があり,以下のような図になってしまいます.それを防ぐために1フレーム前と今との座標の移動量を取ることで,普通のマウスパッドと同じ挙動を再現することにします.  
&nbsp;&nbsp;JacaScript側で1フレーム前の座標を保存する変数を作成し,前と今の座標の差分をx, yそれぞれでとりデータとして送信します.それに伴いPython側の処理では,送信されてきた座標にカーソルを移動するのではなく,現在の座標+送られてきた移動料を新しいカーソルの座標として与えてあげることで実装しました.  
&nbsp;&nbsp;またタップされた座標がわかるということはそこから移動せず指が離れた場合クリックだとわかるようになりました.ここまででできるようになったことは,マウスカーソルの移動,クリックです.

### 4.6 なんやかんや二本指にも対応させる
&nbsp;&nbsp;ここまでがんばって最低限の機能を追加することができました.しかしまだやらなくてはいけないことが残っています！**それはスクロールです！！** Webブラウジングしてもタブは移動できてもスクロールできなければページを見ることができません.キーボードの矢印を使えばいい？んなのトラックパッド使う意味がない！ということでページも少ないですし,ささっと開発をしていきます.  
&nbsp;&nbsp;とりあえずやり方なんてものは知らないので,Googleで「Canvas JS 二本指」と調べます.ただ記事は見つかりましたが,無駄な機能がたくさんあったので読む気が失せました.そこで出てくるChatGPT.彼のおかげで読むのがだるいプログラムでも,作って欲しい内容を入力すれば完結に書いてくれます.「Canvasで二本指でタップした時その座標を出力するプログラムをJavaScriptで書いてください」と入力すると下の図のような結果が返ってきました.AI最高.  
&nbsp;&nbsp;座標さえ取得できればこっちのもので,一本指しかない時はカーソルの移動,二本指で触られている時はY座標をとり,その移動量をサーバーに送信することでスクロールを得ることができます.

## おわりに
&nbsp;&nbsp;このアプリやばいです.尊師スタイルとの相性が良すぎてめちゃめちゃ使えます.もしよかったらGithubで公開しているのでダウンロードして使ってみてください.